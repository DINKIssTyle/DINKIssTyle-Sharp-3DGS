# Sharp Swift 구현 현황 보고서

## 🕒 저장 시간: 2025-12-19 00:09

## ✅ 완료된 핵심 기능
1. **Converter**: `ProcessRunner`를 통한 이미지 -> PLY 변환 (Python 연동).
2. **Viewer Basic**:
   - MetalKit View + SwiftUI 연동.
   - Interactive Camera (Orbit Control, Pan, Zoom).
   - PLY Loader (Header/Body Parsing, Property Detection).
3. **Advanced Rendering**:
   - **Bitonic Sort**: GPU 기반 Depth Sorting (투명도 순서 보장).
   - **Auto Focus**: 로딩 시 Bounding Box 계산 후 카메라 자동 정렬.
   - **True 3DGS Math**:
     - `Scale: exp(rawScale)`
     - `Opacity: sigmoid(rawOpacity)`
     - `Color: SH0 (0.5 + 0.282 * rawRGB)`
     - `Covariance`: 3D Covariance Matrix -> 2D Projected Covariance.
     - `Eigen Decomposition`: Quad 크기(Radius) 및 회전 계산.

## 🚨 현재 이슈 및 상태 (Critical)
- **GPU Hang / Overdraw / Artifacts**:
  - `Covariance` 로직 적용 직후, 특정 상황(Scale 폭발, NaN, Infinite Loop 등)에서 GPU 점유율이 100%로 치솟고 화면이 깨지거나 맥이 멈추는 현상 발생.
  - Voxel처럼 네모난 Splat이 겹쳐 나오는 현상 발생 (Blocky Artifacts).
- **긴급 조치 사항 (Safety Mode 적용 중)**:
  - 현재 `Shaders.metal`은 매우 보수적인 설정으로 롤백됨.
  - `Scale`: `min(exp(scale), 5.0f) * 0.1f` (매우 작게 강제 축소).
  - `Radius`: `min(radius, 48.0f)` (Quad 크기 강제 제한).
  - `Opacity Cull`: 0.05 미만 불투명도 즉시 폐기.
  - `Z-Cull`: `viewPos.z < 0.5` 폐기.
  - `Rotation`: 표준 Quaternion 순서(XYZW)로 임시 복구.

## 📅 재부팅 후 작업 계획 (Next Steps)
1. **GPU Stability Check**: 안전 모드에서 앱이 죽지 않고 실행되는지 우선 확인.
2. **Step-by-Step Tuning**:
   - `Scale Factor` 0.1 -> 1.0으로 서서히 복구하며 GPU 부하 모니터링.
   - `Radius Clamp` 48 -> 128 -> 256으로 완화.
3. **Optimized Covariance**: `J` Matrix 계산 및 `Det` 체크 로직 정밀화하여 Artifact 제거.

**파일 상태:**
- `Shaders.metal`: Safety Mode로 전체 덮어쓰기 완료.
- `MetalRenderer.swift`: 정상 (변수 누락 복구됨).
- `SplatLoader.swift`: 정상.

**재부팅 후 이 문서를 참고하여 `Safety Mode` 해제 및 튜닝을 진행하십시오.**
